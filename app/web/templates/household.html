{% extends "base.html" %}

{% block title %}Streaklet - Household{% endblock %}

{% block content %}
<div class="container" x-data="householdMaintenance()" x-init="processInitialTasks()" x-cloak>
    <header class="page-header">
        <h1>Household Tasks</h1>
        <p class="page-subtitle">Shared tasks for everyone in the household</p>
    </header>

    <!-- View Tabs -->
    <div class="task-tabs" style="margin-bottom: 24px;">
        <button class="tab-button"
                :class="{ 'active': activeView === 'list' }"
                @click="switchView('list')">
            <span>List View</span>
        </button>
        <button class="tab-button"
                :class="{ 'active': activeView === 'calendar' }"
                @click="switchView('calendar')">
            <span>Calendar View</span>
        </button>
    </div>

    <!-- List View -->
    <div x-show="activeView === 'list'">
    <!-- Empty State -->
    <div x-show="!hasVisibleTasks" class="empty-state" style="text-align: center; padding: 60px 20px;">
        <h2 style="color: #52c41a; margin-bottom: 8px;">All caught up!</h2>
        <p style="color: #666;">No household tasks need attention right now.</p>
    </div>

    <!-- Overdue Tasks Section -->
    <section x-show="overdueTasks.length > 0" class="household-section overdue-section">
        <div class="section-header overdue-header">
            <h2>Overdue Tasks</h2>
            <span class="task-count" x-text="overdueTasks.length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in overdueTasks" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household task-card-overdue"
                     :class="{ 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #ff4d4f;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge" :class="task.frequency" x-text="formatFrequency(task.frequency)"></span>
                                <span class="completion-info overdue-text">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- To-Do Items Section -->
    <section x-show="getTasksByFrequency('todo').length > 0" class="household-section">
        <div class="section-header">
            <h2>To-Do Items</h2>
            <span class="task-count" x-text="getTasksByFrequency('todo').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('todo')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household" :class="{ 'task-card-overdue': task.is_overdue }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px;" :style="{ color: task.is_overdue ? '#ff4d4f' : '#595959' }"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge todo">To-Do</span>
                                <span class="completion-info" :class="{ 'overdue-text': task.is_overdue }">
                                    <template x-if="task.due_date">
                                        <span x-text="formatDueDate(task.due_date)"></span>
                                    </template>
                                    <template x-if="!task.due_date">
                                        <span>No due date</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Weekly Tasks -->
    <section x-show="getTasksByFrequency('weekly').length > 0" class="household-section">
        <div class="section-header">
            <h2>Weekly Tasks</h2>
            <span class="task-count" x-text="getTasksByFrequency('weekly').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('weekly')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household"
                     :class="{ 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #0066cc;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge" :class="'frequency-badge-' + task.frequency" x-text="formatFrequency(task.frequency)"></span>
                                <template x-if="task.is_overdue">
                                    <span class="overdue-badge" x-text="`${task.days_overdue} day${task.days_overdue !== 1 ? 's' : ''} overdue`"></span>
                                </template>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Bi-Weekly Tasks -->
    <section x-show="getTasksByFrequency('biweekly').length > 0" class="household-section">
        <div class="section-header">
            <h2>Bi-Weekly Tasks</h2>
            <span class="task-count" x-text="getTasksByFrequency('biweekly').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('biweekly')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household"
                     :class="{ 'task-card-overdue': task.is_overdue, 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #0097a7;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge" :class="'frequency-badge-' + task.frequency" x-text="formatFrequency(task.frequency)"></span>
                                <template x-if="task.is_overdue">
                                    <span class="overdue-badge" x-text="`${task.days_overdue} day${task.days_overdue !== 1 ? 's' : ''} overdue`"></span>
                                </template>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Monthly Tasks -->
    <section x-show="getTasksByFrequency('monthly').length > 0" class="household-section">
        <div class="section-header">
            <h2>Monthly Tasks</h2>
            <span class="task-count" x-text="getTasksByFrequency('monthly').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('monthly')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household"
                     :class="{ 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #5b21b6;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge monthly">Monthly</span>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Quarterly Tasks -->
    <section x-show="getTasksByFrequency('quarterly').length > 0" class="household-section">
        <div class="section-header">
            <h2>Quarterly Tasks</h2>
            <span class="task-count" x-text="getTasksByFrequency('quarterly').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('quarterly')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household"
                     :class="{ 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #d46b08;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge quarterly">Quarterly</span>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Annual Tasks -->
    <section x-show="getTasksByFrequency('annual').length > 0" class="household-section">
        <div class="section-header">
            <h2>Annual Tasks</h2>
            <span class="task-count" x-text="getTasksByFrequency('annual').length"></span>
        </div>
        <div class="household-tasks">
            <template x-for="task in getTasksByFrequency('annual')" :key="task.id">
                <div class="household-task-card unified-task-card task-card-household"
                     :class="{ 'completing': isCompleting(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #7cb305;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge annual">Annual</span>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Recently Completed Section -->
    <section x-show="recentlyCompleted.length > 0" class="household-section">
        <div class="section-header">
            <h2>Recently Completed</h2>
            <span class="task-count" x-text="recentlyCompleted.length"></span>
            <span class="section-subtitle" style="margin-left: 10px; color: #666; font-size: 14px;">(Last 48 hours)</span>
        </div>
        <div class="household-tasks">
            <template x-for="task in recentlyCompleted" :key="'completed-' + task.id">
                <div class="household-task-card unified-task-card task-card-completed"
                     :class="{ 'completing': isUndoing(task.id) }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')"
                                   style="font-size: 24px; color: #52c41a;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                                <span class="completion-badge">✓</span>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge" x-text="formatFrequency(task.frequency)"></span>
                                <span class="completed-text"
                                      x-text="`Completed ${formatRelativeTime(task.last_completed_at)} by ${task.last_completed_by_profile_name}`">
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="undoComplete(task)"
                                :disabled="isUndoing(task.id)"
                                class="btn btn--secondary btn-undo"
                                :class="{ 'disabled': isUndoing(task.id) }">
                                <span x-show="!isUndoing(task.id)">↶ Undo</span>
                                <span x-show="isUndoing(task.id)">⏳ Undoing...</span>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </section>

    <!-- Add New Household Task Card (always visible) -->
    <div style="margin-top: 40px;">
        <div class="add-task-card" @click="showAddHouseholdTaskModal = true">
            <i class="mdi mdi-plus-circle" style="font-size: 32px; color: var(--primary-color);"></i>
            <div class="add-task-card__text">
                <div class="add-task-card__title">Add New Household Task</div>
                <div class="add-task-card__subtitle">Create a shared household task for everyone</div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div x-show="allTasks.length === 0" class="empty-state">
        <p>No household tasks yet.</p>
    </div>
    </div>

    <!-- Calendar View -->
    <div x-show="activeView === 'calendar'">
        <div class="calendar-nav" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <button @click="changeMonth(-1)" class="nav-arrow">‹</button>
            <div class="calendar-month-year" x-text="currentMonthYear"></div>
            <button @click="changeMonth(1)" class="nav-arrow">›</button>
        </div>

        <div class="calendar-container">
            <div class="calendar-grid">
                <!-- Weekday headers -->
                <template x-for="day in weekdays" :key="day">
                    <div class="calendar-header" x-text="day"></div>
                </template>

                <!-- Calendar days -->
                <template x-for="day in calendarDays" :key="day.key">
                    <div
                        class="calendar-day household-calendar-day"
                        :class="{
                            'empty': day.isEmpty,
                            'future': day.isFuture,
                            'today': day.isToday,
                            'has-due-tasks': day.hasDueTasks,
                            'has-overdue-tasks': day.hasOverdueTasks,
                            'has-completed-tasks': day.hasCompletedTasks
                        }"
                        @click="selectCalendarDate(day)"
                        :style="day.taskCount > 0 ? {'cursor': 'pointer'} : {}"
                    >
                        <div class="day-number" x-text="day.dayNumber"></div>
                        <div x-show="day.taskCount > 0" class="task-count-badge" x-text="day.taskCount"></div>
                    </div>
                </template>
            </div>

            <div class="calendar-legend" style="margin-top: 20px;">
                <div class="legend-item">
                    <div class="legend-box" style="background: #fff2f0; border: 2px solid #ff4d4f;"></div>
                    <span>Has Overdue Tasks</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #fffbe6; border: 2px solid #faad14;"></div>
                    <span>Has Tasks Due</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #f6ffed; border: 2px solid #52c41a;"></div>
                    <span>All Completed</span>
                </div>
            </div>
        </div>

        <!-- Selected Day Tasks -->
        <div x-show="selectedDay" style="margin-top: 24px;">
            <h3 style="margin-bottom: 16px;" x-text="selectedDateDisplay"></h3>
            <div x-show="selectedDayTasks.length === 0" class="empty-state">
                <p>No household tasks for this date.</p>
            </div>
            <template x-for="task in selectedDayTasks" :key="task.id">
                <div class="household-task-card" :class="{ 'overdue': task.is_overdue }">
                    <div class="task-main">
                        <div class="task-info">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')" style="font-size: 24px; color: #52c41a;"></i>
                                <h3 x-text="task.title" style="margin: 0;"></h3>
                            </div>
                            <p class="task-description" x-show="task.description" x-text="task.description"></p>
                            <div class="task-meta">
                                <span class="frequency-badge" :class="task.frequency" x-text="task.frequency"></span>
                                <span class="completion-info">
                                    <template x-if="task.last_completed_at">
                                        <span x-text="`Last done ${task.days_since_completion} days ago by ${task.last_completed_by_profile_name}`"></span>
                                    </template>
                                    <template x-if="!task.last_completed_at">
                                        <span>Never completed</span>
                                    </template>
                                </span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button
                                @click="markComplete(task)"
                                :disabled="isCompleting(task.id)"
                                class="btn btn-complete"
                                :class="{ 'disabled': isCompleting(task.id) }">
                                <span x-show="!isCompleting(task.id)">✓ Mark Complete</span>
                                <span x-show="isCompleting(task.id)">⏳ Completing...</span>
                            </button>
                            <button @click="showHistory(task)" class="btn btn--secondary">History</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Recently Completed Section (Calendar View) -->
        <section x-show="recentlyCompleted.length > 0" class="household-section" style="margin-top: 32px;">
            <div class="section-header">
                <h2>Recently Completed</h2>
                <span class="task-count" x-text="recentlyCompleted.length"></span>
                <span class="section-subtitle" style="margin-left: 10px; color: #666; font-size: 14px;">(Last 48 hours)</span>
            </div>
            <div class="household-tasks">
                <template x-for="task in recentlyCompleted" :key="'completed-cal-' + task.id">
                    <div class="household-task-card unified-task-card task-card-completed"
                         :class="{ 'completing': isUndoing(task.id) }">
                        <div class="task-main">
                            <div class="task-info">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <i :class="'mdi mdi-' + (task.icon || 'checkbox-marked-circle')"
                                       style="font-size: 24px; color: #52c41a;"></i>
                                    <h3 x-text="task.title" style="margin: 0;"></h3>
                                    <span class="completion-badge">✓</span>
                                </div>
                                <p class="task-description" x-show="task.description" x-text="task.description"></p>
                                <div class="task-meta">
                                    <span class="frequency-badge" x-text="formatFrequency(task.frequency)"></span>
                                    <span class="completed-text"
                                          x-text="`Completed ${formatRelativeTime(task.last_completed_at)} by ${task.last_completed_by_profile_name}`">
                                    </span>
                                </div>
                            </div>
                            <div class="task-actions">
                                <button
                                    @click="undoComplete(task)"
                                    :disabled="isUndoing(task.id)"
                                    class="btn btn--secondary btn-undo"
                                    :class="{ 'disabled': isUndoing(task.id) }">
                                    <span x-show="!isUndoing(task.id)">↶ Undo</span>
                                    <span x-show="isUndoing(task.id)">⏳ Undoing...</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </section>
    </div>

    <!-- Add Household Task Modal -->
    <div x-show="showAddHouseholdTaskModal" class="modal-overlay" x-cloak @click.self="closeAddHouseholdTaskModal()" @keydown.escape.window="showAddHouseholdTaskModal && closeAddHouseholdTaskModal()">
        <div class="modal-content modal-content--md">
            <div class="modal-header">
                <h2>Add New Household Task</h2>
                <button @click="closeAddHouseholdTaskModal()" class="btn-close">✕</button>
            </div>
            <div class="modal-body">
                <form @submit.prevent="submitHouseholdTask()">
                    <div class="form-field">
                        <label class="form-field__label form-field__label--required">Title</label>
                        <input type="text" class="form-field__input" x-model="newHouseholdTask.title" placeholder="e.g., Clean gutters, Change air filter" required>
                    </div>
                    <div class="form-field">
                        <label class="form-field__label">Description</label>
                        <textarea class="form-field__textarea" x-model="newHouseholdTask.description" rows="3" placeholder="Additional details about this task"></textarea>
                    </div>
                    <div class="form-field">
                        <label class="form-field__label form-field__label--required">Frequency</label>
                        <select class="form-field__select" x-model="newHouseholdTask.frequency" required>
                            <option value="todo">To-Do (one-time)</option>
                            <option value="weekly">Weekly</option>
                            <option value="biweekly">Bi-Weekly (every 2 weeks)</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly (every 3 months)</option>
                            <option value="annual">Annual (once per year)</option>
                        </select>
                    </div>

                    <!-- Schedule Mode (for recurring tasks) -->
                    <div x-show="newHouseholdTask.frequency !== 'todo'" class="form-field">
                        <label class="form-field__label">Schedule Type</label>
                        <div class="form-field__radio-group">
                            <label class="form-field__radio-label">
                                <input type="radio" class="form-field__radio" name="scheduleMode" value="calendar" x-model="newHouseholdTask.schedule_mode">
                                <span>Fixed Schedule - Task appears on specific dates (e.g., every Tuesday)</span>
                            </label>
                            <label class="form-field__radio-label">
                                <input type="radio" class="form-field__radio" name="scheduleMode" value="rolling" x-model="newHouseholdTask.schedule_mode">
                                <span>Rolling Schedule - Task resets from completion date (e.g., every 7 days after done)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Recurrence Configuration -->
                    <div x-show="newHouseholdTask.frequency === 'todo'" class="form-field">
                        <label class="form-field__label">Due Date (optional)</label>
                        <input type="date" class="form-field__input" x-model="newHouseholdTask.due_date">
                    </div>

                    <!-- Weekly/Bi-weekly: Day of Week (calendar mode only) -->
                    <div x-show="(newHouseholdTask.frequency === 'weekly' || newHouseholdTask.frequency === 'biweekly') && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Day of Week</label>
                        <select class="form-field__select" x-model.number="newHouseholdTask.recurrence_day_of_week" required>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>

                    <!-- Monthly: Day of Month (calendar mode only) -->
                    <div x-show="newHouseholdTask.frequency === 'monthly' && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Day of Month</label>
                        <input type="number" class="form-field__input form-field__input--narrow" x-model.number="newHouseholdTask.recurrence_day_of_month" min="1" max="31" placeholder="1-31" required>
                        <span style="font-size: 12px; color: #666; margin-top: 4px; display: block;">Task will appear on this day each month</span>
                    </div>

                    <!-- Quarterly: Month of Quarter + Day (calendar mode only) -->
                    <div x-show="newHouseholdTask.frequency === 'quarterly' && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Month of Quarter</label>
                        <select class="form-field__select" x-model.number="newHouseholdTask.recurrence_month" required>
                            <option value="1">1st month (Jan, Apr, Jul, Oct)</option>
                            <option value="2">2nd month (Feb, May, Aug, Nov)</option>
                            <option value="3">3rd month (Mar, Jun, Sep, Dec)</option>
                        </select>
                    </div>
                    <div x-show="newHouseholdTask.frequency === 'quarterly' && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Day of Month</label>
                        <input type="number" class="form-field__input form-field__input--narrow" x-model.number="newHouseholdTask.recurrence_day" min="1" max="31" placeholder="1-31" required>
                    </div>

                    <!-- Annual: Month + Day (calendar mode only) -->
                    <div x-show="newHouseholdTask.frequency === 'annual' && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Month</label>
                        <select class="form-field__select" x-model.number="newHouseholdTask.recurrence_month" required>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div x-show="newHouseholdTask.frequency === 'annual' && newHouseholdTask.schedule_mode === 'calendar'" class="form-field">
                        <label class="form-field__label form-field__label--required">Day of Month</label>
                        <input type="number" class="form-field__input form-field__input--narrow" x-model.number="newHouseholdTask.recurrence_day" min="1" max="31" placeholder="1-31" required>
                    </div>

                    <div class="form-field">
                        <label class="form-field__label">Icon (optional - auto-assigned from title if not selected)</label>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <button type="button" class="btn btn--secondary" @click="showHouseholdIconPicker = true">
                                <i :class="'mdi mdi-' + (newHouseholdTask.icon || 'checkbox-marked-circle')" style="font-size: 20px;"></i>
                                <span>Choose Icon</span>
                            </button>
                            <template x-if="newHouseholdTask.icon">
                                <button type="button" class="btn btn--secondary btn--sm" @click="newHouseholdTask.icon = null">Clear</button>
                            </template>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn--primary" :disabled="!newHouseholdTask.title.trim()">Add Task</button>
                        <button type="button" class="btn btn--secondary" @click="closeAddHouseholdTaskModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Icon Picker Modal for Household Tasks -->
    <div x-show="showHouseholdIconPicker" class="modal-overlay" x-cloak @click.self="showHouseholdIconPicker = false">
        <div class="modal-content modal-content--md modal-content--scrollable" @click.stop>
            <div class="modal-header">
                <h2>Choose an Icon</h2>
                <button @click="showHouseholdIconPicker = false" class="btn-close">✕</button>
            </div>
            <div class="modal-body">
                <input type="text" class="form-field__input" x-model="householdIconSearch" placeholder="Search icons..." style="margin-bottom: 16px;">
                <div x-show="!hasHouseholdIconResults" style="text-align: center; padding: 20px; color: #999;">
                    No icons found matching "<span x-text="householdIconSearch"></span>"
                </div>
                <template x-for="(icons, category) in filteredHouseholdIcons" :key="category">
                    <div x-show="icons.length > 0" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #666; font-size: 13px; text-transform: uppercase;" x-text="category"></h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px;">
                            <template x-for="icon in icons" :key="icon">
                                <button type="button" @click="selectHouseholdIcon(icon)" class="icon-picker-btn">
                                    <i :class="'mdi mdi-' + icon" style="font-size: 24px;"></i>
                                </button>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div x-show="historyModal.show" class="modal-overlay" x-cloak @click.self="closeHistory()" @keydown.escape.window="historyModal.show && closeHistory()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Completion History</h2>
                <button @click="closeHistory()" class="btn-close">✕</button>
            </div>
            <div class="modal-body">
                <h3 x-text="historyModal.task?.title"></h3>
                <p class="task-description" x-show="historyModal.task?.description" x-text="historyModal.task?.description"></p>

                <div x-show="historyModal.history.length === 0" class="empty-state">
                    No completion history yet.
                </div>

                <div x-show="historyModal.history.length > 0" class="history-list">
                    <template x-for="completion in historyModal.history" :key="completion.id">
                        <div class="history-item">
                            <div class="history-date" x-text="formatDate(completion.completed_at)"></div>
                            <div class="history-profile" x-text="`by ${completion.completed_by_profile_name}`"></div>
                            <div x-show="completion.notes" class="history-notes" x-text="completion.notes"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function householdMaintenance() {
    return {
        activeView: 'list', // 'list' or 'calendar'
        allTasks: [],
        allTasksForCalendar: {{ tasks | tojson }}, // Store ALL tasks for calendar view (SSR data)
        overdueTasks: [],
        recentlyCompleted: [], // Recently completed tasks (last 48 hours)
        completingTaskIds: new Set(), // Track tasks being completed
        undoingTaskIds: new Set(), // Track tasks being undone
        historyModal: {
            show: false,
            task: null,
            history: []
        },

        // Calendar state
        currentYear: new Date().getFullYear(),
        currentMonth: new Date().getMonth() + 1,
        selectedDay: null,
        selectedDayTasks: [],
        weekdays: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],

        // Add task modal state
        showAddHouseholdTaskModal: false,
        showHouseholdIconPicker: false,
        householdIconSearch: '',

        // New household task form
        newHouseholdTask: {
            title: '',
            description: '',
            frequency: 'todo',
            due_date: null,
            icon: null,
            schedule_mode: 'calendar',   // Default: calendar-based
            recurrence_day_of_week: 0,  // Default: Monday
            recurrence_day_of_month: 1, // Default: 1st of month
            recurrence_month: 1,         // Default: Jan / 1st month of quarter
            recurrence_day: 1           // Default: 1st day
        },

        // Household icon categories
        householdIconCategories: window.iconPickerCategories.household,

        // Computed properties for icon picker
        get filteredHouseholdIcons() {
            return window.iconPickerUtils.filterCategories(this.householdIconCategories, this.householdIconSearch);
        },

        get hasHouseholdIconResults() {
            return window.iconPickerUtils.hasVisibleIcons(this.householdIconCategories, this.householdIconSearch);
        },

        processInitialTasks() {
            // Process SSR data that's already loaded
            const tasks = this.allTasksForCalendar;

            // Filter recently completed (last 48 hours)
            const now = new Date();
            const recentlyCompletedTasks = tasks.filter(t => {
                if (!t.last_completed_at) return false;
                const completedDate = new Date(t.last_completed_at);
                const hoursSince = (now - completedDate) / (1000 * 60 * 60);
                return hoursSince <= 48 && t.frequency !== 'todo';
            });

            // Calendar-based recurrence: Show tasks that are currently due
            const dueTasks = tasks.filter(t => t.is_due || t.is_overdue);

            this.allTasks = dueTasks.filter(t => !t.is_overdue);
            this.overdueTasks = dueTasks.filter(t => t.is_overdue);
            this.recentlyCompleted = recentlyCompletedTasks;
        },

        async loadTasks() {
            try {
                // NO fetchWithProfile - household tasks are shared!
                const tasks = await api.household.list();

                // Store ALL tasks for calendar view
                this.allTasksForCalendar = tasks;

                // Filter recently completed (last 48 hours)
                const now = new Date();
                const recentlyCompletedTasks = tasks.filter(t => {
                    if (!t.last_completed_at) return false;
                    const completedDate = new Date(t.last_completed_at);
                    const hoursSince = (now - completedDate) / (1000 * 60 * 60);
                    return hoursSince <= 48 && t.frequency !== 'todo';
                });

                // Calendar-based recurrence: Show tasks that are currently due
                // is_due: task's next due date has arrived (based on calendar recurrence)
                // is_overdue: task is due but overdue (past due date and not completed)
                const dueTasks = tasks.filter(t => t.is_due || t.is_overdue);

                this.allTasks = dueTasks.filter(t => !t.is_overdue);
                this.overdueTasks = dueTasks.filter(t => t.is_overdue);
                this.recentlyCompleted = recentlyCompletedTasks;
            } catch (error) {
                console.error('Error loading household tasks:', error);
            }
        },

        switchView(view) {
            this.activeView = view;
            if (view === 'calendar') {
                this.selectedDay = null;
                this.selectedDayTasks = [];
            }
        },

                getTasksByFrequency(frequency) {
            return this.allTasks.filter(t => t.frequency === frequency);
        },

        get hasVisibleTasks() {
            return this.overdueTasks.length > 0 || this.allTasks.length > 0;
        },

        // All formatters now use global utils.js functions:
        // formatFrequency, formatDueDate

        isCompleting(taskId) {
            return this.completingTaskIds.has(taskId);
        },

        async markComplete(task) {
            // Prevent duplicate completions
            if (this.completingTaskIds.has(task.id)) {
                return;
            }

            this.completingTaskIds.add(task.id);
            try {
                await api.household.complete(task.id);

                // Show success toast
                const profileName = localStorage.getItem('streaklet_profile_name') || 'You';
                toast.success(`"${task.title}" marked complete by ${profileName}`);

                // Wait for fade-out animation to complete
                await new Promise(resolve => setTimeout(resolve, 500));

                await this.loadTasks();
            } catch (error) {
                console.error('Error marking task complete:', error);
                toast.error('Failed to mark task complete');
            } finally {
                this.completingTaskIds.delete(task.id);
            }
        },

        isUndoing(taskId) {
            return this.undoingTaskIds.has(taskId);
        },

        async undoComplete(task) {
            // Prevent duplicate undo operations
            if (this.undoingTaskIds.has(task.id)) {
                return;
            }

            this.undoingTaskIds.add(task.id);
            try {
                await api.household.undo(task.id);

                // Show success toast
                toast.success(`Undone: "${task.title}"`);

                // Wait for fade-out animation
                await new Promise(resolve => setTimeout(resolve, 500));

                await this.loadTasks();
            } catch (error) {
                console.error('Error undoing completion:', error);
                toast.error('Failed to undo completion');
            } finally {
                this.undoingTaskIds.delete(task.id);
            }
        },

        async showHistory(task) {
            this.historyModal.task = task;
            this.historyModal.show = true;
            this.historyModal.history = [];

            try {
                this.historyModal.history = await api.get(`/api/household/tasks/${task.id}/history`, {
                    useProfile: false
                });
            } catch (error) {
                console.error('Error loading history:', error);
            }
        },

        closeHistory() {
            this.historyModal.show = false;
            this.historyModal.task = null;
            this.historyModal.history = [];
        },

        // Modal handling methods
        closeAddHouseholdTaskModal() {
            this.showAddHouseholdTaskModal = false;
            this.newHouseholdTask = {
                title: '',
                description: '',
                frequency: 'todo',
                due_date: null,
                icon: null,
                schedule_mode: 'calendar',
                recurrence_day_of_week: 0,
                recurrence_day_of_month: 1,
                recurrence_month: 1,
                recurrence_day: 1
            };
            this.householdIconSearch = '';
        },

        selectHouseholdIcon(icon) {
            this.newHouseholdTask.icon = icon;
            this.showHouseholdIconPicker = false;
            this.householdIconSearch = '';
        },

        async submitHouseholdTask() {
            if (!this.newHouseholdTask.title.trim()) return;

            try {
                const payload = {
                    title: this.newHouseholdTask.title,
                    description: this.newHouseholdTask.description || '',
                    frequency: this.newHouseholdTask.frequency,
                    due_date: this.newHouseholdTask.frequency === 'todo' ? this.newHouseholdTask.due_date : null,
                    icon: this.newHouseholdTask.icon,
                    sort_order: 0,
                    is_active: true
                };

                // Add schedule_mode for recurring tasks
                if (this.newHouseholdTask.frequency !== 'todo') {
                    payload.schedule_mode = this.newHouseholdTask.schedule_mode;
                }

                // Add recurrence fields based on frequency
                if (this.newHouseholdTask.frequency === 'weekly' || this.newHouseholdTask.frequency === 'biweekly') {
                    payload.recurrence_day_of_week = this.newHouseholdTask.recurrence_day_of_week;
                } else if (this.newHouseholdTask.frequency === 'monthly') {
                    payload.recurrence_day_of_month = this.newHouseholdTask.recurrence_day_of_month;
                } else if (this.newHouseholdTask.frequency === 'quarterly') {
                    payload.recurrence_month = this.newHouseholdTask.recurrence_month;
                    payload.recurrence_day = this.newHouseholdTask.recurrence_day;
                } else if (this.newHouseholdTask.frequency === 'annual') {
                    payload.recurrence_month = this.newHouseholdTask.recurrence_month;
                    payload.recurrence_day = this.newHouseholdTask.recurrence_day;
                }

                await api.household.create(payload);

                this.closeAddHouseholdTaskModal();
                await this.loadTasks();
                toast.success('Household task created successfully');
            } catch (error) {
                console.error('Error creating household task:', error);
                toast.error('Failed to create household task');
            }
        },

        formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
        },

        formatRelativeTime(datetime) {
            if (!datetime) return '';
            const date = new Date(datetime);
            const now = new Date();
            const hoursSince = Math.floor((now - date) / (1000 * 60 * 60));

            if (hoursSince < 1) return 'just now';
            if (hoursSince === 1) return '1 hour ago';
            if (hoursSince < 24) return `${hoursSince} hours ago`;

            const daysSince = Math.floor(hoursSince / 24);
            if (daysSince === 1) return 'yesterday';
            return `${daysSince} days ago`;
        },

        // Calendar methods
        get currentMonthYear() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            return `${monthNames[this.currentMonth - 1]} ${this.currentYear}`;
        },

        get selectedDateDisplay() {
            if (!this.selectedDay) return '';
            return this.selectedDay;
        },

        changeMonth(delta) {
            this.currentMonth += delta;
            if (this.currentMonth > 12) {
                this.currentMonth = 1;
                this.currentYear++;
            } else if (this.currentMonth < 1) {
                this.currentMonth = 12;
                this.currentYear--;
            }
            this.selectedDay = null;
            this.selectedDayTasks = [];
        },

        get calendarDays() {
            const days = [];
            const firstDay = new Date(this.currentYear, this.currentMonth - 1, 1);
            const lastDay = new Date(this.currentYear, this.currentMonth, 0);
            const daysInMonth = lastDay.getDate();

            // Get first day of week (0 = Sunday, convert to 0 = Monday)
            let firstDayWeekday = firstDay.getDay() - 1;
            if (firstDayWeekday < 0) firstDayWeekday = 6;

            const today = new Date().toISOString().split('T')[0];

            // Add empty cells for days before month starts
            for (let i = 0; i < firstDayWeekday; i++) {
                days.push({ isEmpty: true, key: `empty-${i}` });
            }

            // Add actual days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${this.currentYear}-${String(this.currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const tasksForDay = this.getTasksForDate(dateStr);

                // Check task states for this day
                const hasOverdue = tasksForDay.some(t => {
                    // Task is overdue if next_due_date is before today and not completed recently
                    return t.next_due_date && t.next_due_date < today &&
                           (!t.last_completed_at || new Date(t.last_completed_at).toISOString().split('T')[0] < t.next_due_date);
                });

                const hasDue = tasksForDay.some(t => {
                    // Task is due if next_due_date matches this date and not completed yet
                    if (t.next_due_date !== dateStr) return false;
                    if (!t.last_completed_at) return true; // Never completed = due
                    // Check if completed today or after due date
                    const completedDate = new Date(t.last_completed_at).toISOString().split('T')[0];
                    return completedDate < dateStr; // Completed before this due date = still due
                });

                const hasCompleted = tasksForDay.some(t => {
                    // Task was completed on this date
                    if (!t.last_completed_at) return false;
                    const completedDate = new Date(t.last_completed_at).toISOString().split('T')[0];
                    return completedDate === dateStr;
                });

                days.push({
                    dayNumber: day,
                    dateStr: dateStr,
                    isEmpty: false,
                    isFuture: dateStr > today,
                    isToday: dateStr === today,
                    taskCount: tasksForDay.length,
                    hasOverdueTasks: hasOverdue,
                    hasDueTasks: hasDue && !hasOverdue, // Due but not overdue
                    hasCompletedTasks: hasCompleted && !hasOverdue && !hasDue, // Only green if nothing overdue/due
                    key: dateStr
                });
            }

            return days;
        },

        getTasksForDate(dateStr) {
            const taskDate = new Date(dateStr + 'T00:00:00');
            const today = new Date().toISOString().split('T')[0];

            return this.allTasksForCalendar.filter(task => {
                // Check if task was completed on this date
                if (task.last_completed_at) {
                    const completedDate = new Date(task.last_completed_at).toISOString().split('T')[0];
                    if (completedDate === dateStr) {
                        return true; // Show tasks completed on this date
                    }
                }

                // Handle to-do items
                if (task.frequency === 'todo') {
                    if (task.due_date && !task.is_completed) {
                        return task.due_date === dateStr;
                    }
                    if (!task.due_date && !task.is_completed) {
                        return dateStr === today;
                    }
                    return false;
                }

                // For recurring tasks, calculate if this date matches the recurrence pattern
                if (task.schedule_mode === 'calendar') {
                    // Weekly: Check if day of week matches
                    if (task.frequency === 'weekly' && task.recurrence_day_of_week !== null) {
                        // Get day of week (0=Monday, 6=Sunday)
                        const dayOfWeek = taskDate.getDay() === 0 ? 6 : taskDate.getDay() - 1;
                        return dayOfWeek === task.recurrence_day_of_week && dateStr >= today;
                    }

                    // Bi-weekly: Check if day of week matches (more complex - needs to check interval)
                    if (task.frequency === 'biweekly' && task.recurrence_day_of_week !== null) {
                        const dayOfWeek = taskDate.getDay() === 0 ? 6 : taskDate.getDay() - 1;
                        if (dayOfWeek !== task.recurrence_day_of_week || dateStr < today) return false;

                        // Check if it's the right interval (every 2 weeks)
                        // Use next_due_date as reference point
                        if (task.next_due_date) {
                            const nextDue = new Date(task.next_due_date + 'T00:00:00');
                            const daysDiff = Math.floor((taskDate - nextDue) / (1000 * 60 * 60 * 24));
                            return daysDiff % 14 === 0 && dateStr >= today;
                        }
                        return false;
                    }

                    // Monthly: Check if day of month matches
                    if (task.frequency === 'monthly' && task.recurrence_day_of_month !== null) {
                        return taskDate.getDate() === task.recurrence_day_of_month && dateStr >= today;
                    }

                    // Quarterly: Check if it's the right month and day
                    if (task.frequency === 'quarterly' && task.recurrence_month !== null && task.recurrence_day !== null) {
                        const month = taskDate.getMonth() + 1;
                        const isQuarterMonth = (month - task.recurrence_month) % 3 === 0;
                        return isQuarterMonth && taskDate.getDate() === task.recurrence_day && dateStr >= today;
                    }

                    // Annual: Check if month and day match
                    if (task.frequency === 'annual' && task.recurrence_month !== null && task.recurrence_day !== null) {
                        return taskDate.getMonth() + 1 === task.recurrence_month &&
                               taskDate.getDate() === task.recurrence_day &&
                               dateStr >= today;
                    }
                }

                // Fallback to next_due_date for rolling mode or incomplete calendar config
                if (task.next_due_date) {
                    return task.next_due_date === dateStr;
                }

                // Never-completed tasks show today
                if (!task.last_completed_at) {
                    return dateStr === today;
                }

                return false;
            });
        },

        selectCalendarDate(day) {
            if (day.isEmpty || day.taskCount === 0) return;

            this.selectedDay = new Date(day.dateStr).toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            this.selectedDayTasks = this.getTasksForDate(day.dateStr);
        }
    }
}
</script>

<style>
.page-header {
    margin-bottom: 30px;
}

.page-subtitle {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
}

.household-section {
    margin-bottom: 40px;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border-color);
}

.section-header h2 {
    font-size: 20px;
    margin: 0;
}

.task-count {
    background: var(--primary-color);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
}

.overdue-section {
    background: #fff5f5;
    padding: 20px;
    border-radius: 12px;
    border: 2px solid #ff4d4f;
}

.overdue-header {
    border-bottom-color: #ff4d4f;
}

.overdue-header .task-count {
    background: #ff4d4f;
}

.task-card-completed {
    border-color: #52c41a;
    background: #f6ffed;
    opacity: 0.9;
}

.completion-badge {
    background: #52c41a;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
}

.completed-text {
    color: #52c41a;
    font-weight: 500;
}

.btn-undo {
    background: #fff;
    border: 1px solid #d9d9d9;
    color: #595959;
}

.btn-undo:hover:not(.disabled) {
    border-color: #40a9ff;
    color: #40a9ff;
}

.household-tasks {
    display: grid;
    gap: 15px;
}

.household-task-card {
    background: white;
    border: 2px solid #52c41a;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s;
}

.household-task-card.overdue {
    border-color: #ff4d4f;
    background: #fffbfb;
}

.household-task-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.household-task-card.completing {
    animation: taskFadeOut 0.5s ease-out forwards;
}

@keyframes taskFadeOut {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
}

.task-main {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.task-info h3 {
    margin: 0 0 8px 0;
    font-size: 18px;
    color: #333;
}

.task-description {
    color: #666;
    font-size: 14px;
    margin: 0 0 12px 0;
}

.task-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.frequency-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: capitalize;
}

.frequency-badge.frequency-badge-weekly,
.frequency-badge.weekly {
    background: #e6f7ff;
    color: #0066cc;
}

.frequency-badge.frequency-badge-biweekly,
.frequency-badge.biweekly {
    background: #e0f7fa;
    color: #0097a7;
}

.frequency-badge.frequency-badge-monthly,
.frequency-badge.monthly {
    background: #f0f5ff;
    color: #5b21b6;
}

.frequency-badge.frequency-badge-quarterly,
.frequency-badge.quarterly {
    background: #fff7e6;
    color: #d46b08;
}

.frequency-badge.frequency-badge-annual,
.frequency-badge.annual {
    background: #fcffe6;
    color: #7cb305;
}

.frequency-badge.frequency-badge-todo,
.frequency-badge.todo {
    background: #f0f0f0;
    color: #595959;
}

.overdue-badge {
    display: inline-block;
    padding: 2px 8px;
    background: #fff1f0;
    color: #ff4d4f;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.completion-info {
    font-size: 13px;
    color: #666;
}

.overdue-text {
    color: #ff4d4f;
    font-weight: 600;
}

.task-actions {
    display: flex;
    gap: 10px;
}

/* Button and empty state styles now in components.css */

/* Modal and button styles now in components.css */

/* History-specific styles */
.history-list {
    margin-top: 20px;
}

.history-item {
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
    margin-bottom: 10px;
}

.history-date {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
}

.history-profile {
    color: #666;
    font-size: 14px;
}

.history-notes {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid #e0e0e0;
    font-size: 13px;
    color: #666;
    font-style: italic;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .task-main {
        gap: 12px;
    }

    .task-actions {
        flex-direction: column;
    }

    .btn-complete {
        flex: none;
    }
}

/* Calendar View Styles */
.household-calendar-day {
    position: relative;
}

.household-calendar-day.has-overdue-tasks {
    background: #fff2f0;
    border: 2px solid #ff4d4f;
}

.household-calendar-day.has-due-tasks {
    background: #fffbe6;
    border: 2px solid #faad14;
}

.household-calendar-day.has-completed-tasks {
    background: #f6ffed;
    border: 2px solid #52c41a;
}

.task-count-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #1890ff;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
}

.household-calendar-day.has-overdue-tasks .task-count-badge {
    background: #ff4d4f;
}

.household-calendar-day.has-due-tasks .task-count-badge {
    background: #faad14;
}

.household-calendar-day.has-completed-tasks .task-count-badge {
    background: #52c41a;
}

.calendar-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.nav-arrow {
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    width: 40px;
    height: 40px;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.nav-arrow:hover {
    background: var(--bg-color);
    border-color: var(--primary-color);
}

.calendar-month-year {
    font-size: 18px;
    font-weight: 600;
    color: #333;
}

/* Add Task Card */
.add-task-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 2px dashed var(--primary-color);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.add-task-card:hover {
    background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
    border-color: #1976d2;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.15);
}

.add-task-card__text {
    flex: 1;
}

.add-task-card__title {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 4px;
}

.add-task-card__subtitle {
    font-size: 13px;
    color: #666;
}

/* Icon Picker Button */
.icon-picker-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
}

.icon-picker-btn:hover {
    border-color: var(--primary-color);
    background: #f0f7ff;
    transform: scale(1.05);
}

.icon-picker-btn:active {
    transform: scale(0.95);
}

@media (max-width: 480px) {
    .add-task-card {
        padding: 16px;
        gap: 12px;
    }

    .add-task-card i {
        font-size: 28px !important;
    }

    .add-task-card__title {
        font-size: 15px;
    }

    .add-task-card__subtitle {
        font-size: 12px;
    }
}
</style>
{% endblock %}
